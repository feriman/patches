--- newsraft/src/parse_xml/setup-xml-parser.c.orig	2025-07-22 19:13:13.000000000 +0300
+++ newsraft/src/parse_xml/setup-xml-parser.c	2025-10-05 13:36:07.828369717 +0300
@@ -62,6 +62,65 @@
 	}
 }
 
+static int XMLCALL
+koi8r_encoding_handler(void *data, const XML_Char *encoding, XML_Encoding *info)
+{
+	if (strcmp(encoding, "koi8-r") == 0) {
+		int i;
+		for (i = 0; i < 128; ++i) {
+			info->map[i] = i;
+		}
+		info->map[0x80] = 0x2500; info->map[0x81] = 0x2502; info->map[0x82] = 0x250C;
+		info->map[0x83] = 0x2510; info->map[0x84] = 0x2514; info->map[0x85] = 0x2518;
+		info->map[0x86] = 0x251C; info->map[0x87] = 0x2524; info->map[0x88] = 0x252C;
+		info->map[0x89] = 0x2534; info->map[0x8A] = 0x253C; info->map[0x8B] = 0x2580;
+		info->map[0x8C] = 0x2584; info->map[0x8D] = 0x2588; info->map[0x8E] = 0x258C;
+		info->map[0x8F] = 0x2590; info->map[0x90] = 0x2591; info->map[0x91] = 0x2592;
+		info->map[0x92] = 0x2593; info->map[0x93] = 0x2320; info->map[0x94] = 0x25A0;
+		info->map[0x95] = 0x2219; info->map[0x96] = 0x221A; info->map[0x97] = 0x2248;
+		info->map[0x98] = 0x2264; info->map[0x99] = 0x2265; info->map[0x9A] = 0x00A0;
+		info->map[0x9B] = 0x2321; info->map[0x9C] = 0x00B0; info->map[0x9D] = 0x00B2;
+		info->map[0x9E] = 0x00B7; info->map[0x9F] = 0x00F7; info->map[0xA0] = 0x2550;
+		info->map[0xA1] = 0x2551; info->map[0xA2] = 0x2552; info->map[0xA3] = 0x0451;
+		info->map[0xA4] = 0x2553; info->map[0xA5] = 0x2554; info->map[0xA6] = 0x2555;
+		info->map[0xA7] = 0x2556; info->map[0xA8] = 0x2557; info->map[0xA9] = 0x2558;
+		info->map[0xAA] = 0x2559; info->map[0xAB] = 0x255A; info->map[0xAC] = 0x255B;
+		info->map[0xAD] = 0x255C; info->map[0xAE] = 0x255D; info->map[0xAF] = 0x255E;
+		info->map[0xB0] = 0x255F; info->map[0xB1] = 0x2560; info->map[0xB2] = 0x2561;
+		info->map[0xB3] = 0x0401; info->map[0xB4] = 0x2562; info->map[0xB5] = 0x2563;
+		info->map[0xB6] = 0x2564; info->map[0xB7] = 0x2565; info->map[0xB8] = 0x2566;
+		info->map[0xB9] = 0x2567; info->map[0xBA] = 0x2568; info->map[0xBB] = 0x2569;
+		info->map[0xBC] = 0x256A; info->map[0xBD] = 0x256B; info->map[0xBE] = 0x256C;
+		info->map[0xBF] = 0x00A9; info->map[0xC0] = 0x044E; info->map[0xC1] = 0x0430;
+		info->map[0xC2] = 0x0431; info->map[0xC3] = 0x0446; info->map[0xC4] = 0x0434;
+		info->map[0xC5] = 0x0435; info->map[0xC6] = 0x0444; info->map[0xC7] = 0x0433;
+		info->map[0xC8] = 0x0445; info->map[0xC9] = 0x0438; info->map[0xCA] = 0x0439;
+		info->map[0xCB] = 0x043A; info->map[0xCC] = 0x043B; info->map[0xCD] = 0x043C;
+		info->map[0xCE] = 0x043D; info->map[0xCF] = 0x043E; info->map[0xD0] = 0x043F;
+		info->map[0xD1] = 0x044F; info->map[0xD2] = 0x0440; info->map[0xD3] = 0x0441;
+		info->map[0xD4] = 0x0442; info->map[0xD5] = 0x0443; info->map[0xD6] = 0x0436;
+		info->map[0xD7] = 0x0432; info->map[0xD8] = 0x044C; info->map[0xD9] = 0x044B;
+		info->map[0xDA] = 0x0437; info->map[0xDB] = 0x0448; info->map[0xDC] = 0x044D;
+		info->map[0xDD] = 0x0449; info->map[0xDE] = 0x0447; info->map[0xDF] = 0x044A;
+		info->map[0xE0] = 0x042E; info->map[0xE1] = 0x0410; info->map[0xE2] = 0x0411;
+		info->map[0xE3] = 0x0426; info->map[0xE4] = 0x0414; info->map[0xE5] = 0x0415;
+		info->map[0xE6] = 0x0424; info->map[0xE7] = 0x0413; info->map[0xE8] = 0x0425;
+		info->map[0xE9] = 0x0418; info->map[0xEA] = 0x0419; info->map[0xEB] = 0x041A;
+		info->map[0xEC] = 0x041B; info->map[0xED] = 0x041C; info->map[0xEE] = 0x041D;
+		info->map[0xEF] = 0x041E; info->map[0xF0] = 0x041F; info->map[0xF1] = 0x042F;
+		info->map[0xF2] = 0x0420; info->map[0xF3] = 0x0421; info->map[0xF4] = 0x0422;
+		info->map[0xF5] = 0x0423; info->map[0xF6] = 0x0416; info->map[0xF7] = 0x0412;
+		info->map[0xF8] = 0x042C; info->map[0xF9] = 0x042B; info->map[0xFA] = 0x0417;
+		info->map[0xFB] = 0x0428; info->map[0xFC] = 0x042D; info->map[0xFD] = 0x0429;
+		info->map[0xFE] = 0x0427; info->map[0xFF] = 0x042A;
+		info->data = NULL;
+		info->convert = NULL;
+		info->release = NULL;
+		return XML_STATUS_OK;
+	}
+	return XML_STATUS_ERROR;
+}
+
 bool
 setup_xml_parser(struct feed_update_state *data)
 {
@@ -76,5 +135,6 @@
 	XML_SetElementHandler(data->xml_parser, &start_element_handler, &end_element_handler);
 	XML_SetCharacterDataHandler(data->xml_parser, &character_data_handler);
 	XML_SetDefaultHandler(data->xml_parser, &xml_default_handler);
+	XML_SetUnknownEncodingHandler(data->xml_parser, &koi8r_encoding_handler, NULL);
 	return true;
 }
